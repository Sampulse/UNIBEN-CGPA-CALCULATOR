<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nigerian CGPA Calculator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f7fa; margin: 0; padding: 0; }
    header { background: #0a3d62; color: #fff; text-align: center; padding: 1rem; }
    main { max-width: 1000px; margin: 2rem auto; background: #fff; padding: 2rem; border-radius: 8px;
           box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    h2 { color: #0a3d62; }
    .tabs { display: flex; margin-bottom: 1rem; }
    .tab { flex: 1; padding: 10px; background: #ddd; text-align: center; cursor: pointer; border: 1px solid #bbb; }
    .tab.active { background: #0a3d62; color: white; font-weight: bold; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
    th, td { border: 1px solid #ddd; padding: .75rem; text-align: center; }
    th { background: #0a3d62; color: white; }
    button { background: #0a3d62; color: white; padding: .6rem 1rem; border: none; border-radius: 4px; cursor: pointer; margin: 0.25rem; }
    button:hover { background: #07406d; }
    .result { margin-top: 1.5rem; padding: 1rem; background: #eaf4fc; border-left: 5px solid #0a3d62; }
    select, input { padding: .4rem; border: 1px solid #ccc; border-radius: 4px; }
    .export-buttons { margin-top: 1.5rem; }
  </style>
</head>
<body>
  <header>
    <h1>üéì Nigerian CGPA Calculator</h1>
    <p>Multi-Semester GPA + CGPA Tracker</p>
  </header>

  <main>
    <div class="tabs" id="tabs"></div>
    <div id="tabContents"></div>
    <button onclick="addSemester()">‚ûï Add Semester</button>

    <div id="cgpaResult" class="result"></div>

    <div class="export-buttons">
      <button onclick="exportPDF()">üìÑ Export to PDF</button>
      <button onclick="exportExcel()">üìä Export to Excel</button>
    </div>
  </main>

  <script>
    const gradePoints = { A: 5, B: 4, C: 3, D: 2, E: 1, F: 0 };
    let semesters = JSON.parse(localStorage.getItem("semesters")) || [];

    function saveData() {
      localStorage.setItem("semesters", JSON.stringify(semesters));
      calculateCGPA();
    }

    function renderTabs() {
      const tabs = document.getElementById("tabs");
      const contents = document.getElementById("tabContents");
      tabs.innerHTML = "";
      contents.innerHTML = "";

      semesters.forEach((sem, i) => {
        const tab = document.createElement("div");
        tab.className = "tab" + (i === 0 ? " active" : "");
        tab.innerText = `Semester ${i+1}`;
        tab.onclick = () => switchTab(i);
        tabs.appendChild(tab);

        const content = document.createElement("div");
        content.className = "tab-content" + (i === 0 ? " active" : "");
        content.innerHTML = `
          <h2>Semester ${i+1}</h2>
          <table>
            <thead>
              <tr>
                <th>Course Code</th>
                <th>Credit Units</th>
                <th>Grade</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="courseBody${i}">
              ${sem.courses.map(c => `
                <tr>
                  <td><input type="text" value="${c.code}"></td>
                  <td><input type="number" min="1" value="${c.units}"></td>
                  <td>
                    <select>
                      ${Object.keys(gradePoints).map(g =>
                        `<option ${c.grade===g?"selected":""}>${g}</option>`).join("")}
                    </select>
                  </td>
                  <td><button onclick="removeCourse(${i}, this)">‚ùå</button></td>
                </tr>`).join("")}
            </tbody>
          </table>
          <button onclick="addCourse(${i})">‚ûï Add Course</button>
          <button onclick="calculateGPA(${i})">üìä Calculate GPA</button>
          <div class="result" id="result${i}">${sem.gpa ? `Semester GPA: ${sem.gpa} (${classify(sem.gpa)})` : ""}</div>
        `;
        contents.appendChild(content);
      });
    }

    function switchTab(index) {
      document.querySelectorAll(".tab").forEach((tab, i) => {
        tab.classList.toggle("active", i === index);
      });
      document.querySelectorAll(".tab-content").forEach((c, i) => {
        c.classList.toggle("active", i === index);
      });
    }

    function addSemester() {
      semesters.push({ courses: [], gpa: null, totalUnits: 0, totalPoints: 0 });
      saveData();
      renderTabs();
    }

    function addCourse(semIndex) {
      semesters[semIndex].courses.push({ code: "", units: 3, grade: "A" });
      saveData();
      renderTabs();
      switchTab(semIndex);
    }

    function removeCourse(semIndex, btn) {
      const rowIndex = btn.parentElement.parentElement.rowIndex - 1;
      semesters[semIndex].courses.splice(rowIndex, 1);
      saveData();
      renderTabs();
      switchTab(semIndex);
    }

    function calculateGPA(semIndex) {
      const rows = document.querySelectorAll(`#courseBody${semIndex} tr`);
      let totalUnits = 0, totalPoints = 0;
      let updatedCourses = [];

      rows.forEach(row => {
        const code = row.children[0].querySelector("input").value;
        const units = parseInt(row.children[1].querySelector("input").value);
        const grade = row.children[2].querySelector("select").value;

        totalUnits += units;
        totalPoints += units * gradePoints[grade];
        updatedCourses.push({ code, units, grade });
      });

      const gpa = (totalPoints / totalUnits).toFixed(2);
      semesters[semIndex] = { courses: updatedCourses, gpa, totalUnits, totalPoints };
      saveData();

      document.getElementById(`result${semIndex}`).innerHTML =
        `<strong>Semester GPA:</strong> ${gpa} (${classify(gpa)})`;
    }

    function calculateCGPA() {
      let totalUnits = 0, totalPoints = 0;
      semesters.forEach(sem => {
        if (sem.totalUnits) {
          totalUnits += sem.totalUnits;
          totalPoints += sem.totalPoints;
        }
      });
      if (totalUnits === 0) return;
      const cgpa = (totalPoints / totalUnits).toFixed(2);
      document.getElementById("cgpaResult").innerHTML = `
        <h2>üìä Overall CGPA: ${cgpa} (${classify(cgpa)})</h2>
        <em>Across ${semesters.length} semester(s)</em>
      `;
    }

    function classify(gpa) {
      gpa = parseFloat(gpa);
      if (gpa >= 4.5) return "First Class Honours";
      if (gpa >= 3.5) return "Second Class Upper";
      if (gpa >= 2.5) return "Second Class Lower";
      if (gpa >= 1.5) return "Third Class";
      return "Pass / Fail";
    }

    // üìÑ Export to PDF
    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(14);
      doc.text("Nigerian CGPA Report", 70, 20);

      let y = 30;
      semesters.forEach((sem, i) => {
        doc.text(`Semester ${i+1} - GPA: ${sem.gpa || "Not Calculated"}`, 14, y);
        y += 6;
        sem.courses.forEach(c => {
          doc.text(`  ${c.code} | ${c.units} units | Grade: ${c.grade}`, 14, y);
          y += 6;
        });
        y += 4;
      });

      let totalUnits = semesters.reduce((sum, s) => sum+s.totalUnits, 0);
      let totalPoints = semesters.reduce((sum, s) => sum+s.totalPoints, 0);
      let cgpa = totalUnits ? (totalPoints/totalUnits).toFixed(2) : "N/A";

      doc.text(`Overall CGPA: ${cgpa} (${classify(cgpa)})`, 14, y+10);
      doc.save("CGPA_Report.pdf");
    }

    // üìä Export to Excel
    function exportExcel() {
      let wb = XLSX.utils.book_new();
      semesters.forEach((sem, i) => {
        let ws_data = [["Course Code", "Credit Units", "Grade"]];
        sem.courses.forEach(c => {
          ws_data.push([c.code, c.units, c.grade]);
        });
        ws_data.push([]);
        ws_data.push(["GPA", sem.gpa || "Not Calculated"]);
        let ws = XLSX.utils.aoa_to_sheet(ws_data);
        XLSX.utils.book_append_sheet(wb, ws, `Semester ${i+1}`);
      });

      let totalUnits = semesters.reduce((sum, s) => sum+s.totalUnits, 0);
      let totalPoints = semesters.reduce((sum, s) => sum+s.totalPoints, 0);
      let cgpa = totalUnits ? (totalPoints/totalUnits).toFixed(2) : "N/A";

      let summary = [["Overall CGPA", cgpa, classify(cgpa)]];
      let ws_summary = XLSX.utils.aoa_to_sheet(summary);
      XLSX.utils.book_append_sheet(wb, ws_summary, "Summary");

      XLSX.writeFile(wb, "CGPA_Report.xlsx");
    }

    // Initialize
    if (semesters.length === 0) addSemester();
    else renderTabs();
    calculateCGPA();
  </script>
</body>
</html>
